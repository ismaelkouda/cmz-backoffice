<div class="container-fluid">
    <div class="row">
        <div class="col-sm-12">
            <app-breadcrumb
                [title]="getTitle.module | translate"
                [active_item]="getTitle.subModule | translate"
            ></app-breadcrumb>
            <div class="card">
                <div class="card-body">
                    <div *ngIf="!displayUrlErrorPage">
                        <div *ngIf="!spinner">
                            <div class="d-flex justify-content-between mb-3">
                                <h4>
                                    <b>
                                        <span>
                                            Référence de
                                            <span
                                                *ngIf="detailsInvoiceForm?.['reference']"
                                                >la facture</span
                                            >
                                            <span
                                                *ngIf="!detailsInvoiceForm?.['reference'] && detailsInvoiceForm?.['etat_paiement']"
                                                >la proforma</span
                                            >
                                            :
                                        </span>
                                        <span class="current_values">
                                            [{{ detailsInvoiceForm?.['reference'] ??
                                            detailsInvoiceForm?.['numero_demande']

                                            }}]
                                        </span>
                                        <span
                                            [class]="
                                                'badge ' +
                                                getStatutBadge(
                                                    detailsInvoiceForm
                                                )
                                            "
                                            [ngStyle]="{
                                                width: 'fit-content',
                                                'font-size': '18px'
                                            }"
                                        >
                                            {{
                                                detailsInvoiceForm?.etat_paiement
                                            }}
                                        </span>
                                        &nbsp; [Montant :
                                        <span class="text-orange">
                                            {{ detailsInvoiceForm?.prix_ttc }}
                                            Fcfa </span
                                        >]
                                    </b>
                                </h4>

                                <div class="forms-feature-header__button">
                                    <div class="d-flex gap-3">
                                        <p-button
                                            label="Enregistrer"
                                            styleClass="p-button-success"
                                            tooltipPosition="top"
                                            pTooltip="Enregistrer le paiement"
                                            [class.p-disabled]="
                                                formTypePaiement.invalid
                                            "
                                            (click)="
                                                postTraitementsSuivisPaiementDemandeService()
                                            "
                                            *ngIf="
                                                urlParamRef !== 'view-invoice'
                                            "
                                        >
                                        </p-button>
                                        <p-button
                                            label="Exporter"
                                            styleClass="p-button-primary"
                                            tooltipPosition="top"
                                            pTooltip="Exporter la facture"
                                            printSectionId="print-section"
                                            ngxPrint
                                            (click)="postExportInvoice()"
                                        ></p-button>
                                        <p-button
                                            label="Fermer"
                                            styleClass="p-button-danger"
                                            (click)="onGoToBack()"
                                        ></p-button>
                                    </div>
                                </div>
                            </div>

                            <div id="print-section">
                                <div>
                                    <div
                                        class="d-flex justify-content-around align-items-center gap-10"
                                    >
                                        <div>
                                            <img
                                                class="img-fluid"
                                                [src]="logoTenant"
                                                width="250"
                                                height="250"
                                                alt="Logo du client"
                                            />
                                        </div>
                                        <div>
                                            <p class="text-secondary fs-6">
                                                <span
                                                    class="text-orange fw-bolder"
                                                    >RCCM&nbsp;:&nbsp;</span
                                                >{{
                                                    detailsInvoiceForm
                                                        ?.orangeInfo?.rccm ??
                                                        'N/A'
                                                }}<br />
                                                <span
                                                    class="text-orange fw-bolder"
                                                    >CC&nbsp;:&nbsp;</span
                                                >{{
                                                    detailsInvoiceForm
                                                        ?.orangeInfo?.cc ??
                                                        'N/A'
                                                }}&nbsp;{{
                                                    detailsInvoiceForm
                                                        ?.orangeInfo?.adresse ??
                                                        'N/A'
                                                }}<br />
                                                <span
                                                    class="text-orange fw-bolder"
                                                    >Email&nbsp;:&nbsp;</span
                                                >{{
                                                    detailsInvoiceForm
                                                        ?.orangeInfo?.email ??
                                                        'N/A'
                                                }}<br />
                                                <span
                                                    class="text-orange fw-bolder"
                                                    >Contacts&nbsp;:&nbsp;</span
                                                >{{
                                                    detailsInvoiceForm
                                                        ?.orangeInfo
                                                        ?.contact_1 ?? 'N/A'
                                                }}
                                                /
                                                {{
                                                    detailsInvoiceForm
                                                        ?.orangeInfo
                                                        ?.contact_2 ?? 'N/A'
                                                }}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div class="row px-5 pt-2">
                                    <div class="col-12">
                                        <table
                                            [ngClass]="['native_table table']"
                                        >
                                            <tbody>
                                                <tr>
                                                    <td
                                                        colspan="2"
                                                        class="text-center"
                                                    >
                                                        <b class="fs-5">
                                                            <span
                                                                *ngIf="detailsInvoiceForm?.['reference']"
                                                                >Facture</span
                                                            >
                                                            <span
                                                                *ngIf="!detailsInvoiceForm?.['reference'] && detailsInvoiceForm?.['etat_paiement']"
                                                                >Proforma</span
                                                            >
                                                        </b>
                                                    </td>
                                                    <td
                                                        rowspan="2"
                                                        class="align-middle text-start"
                                                    >
                                                        <b class="fs-5">
                                                            À l'attention de
                                                            [&nbsp;{{
                                                                detailsInvoiceForm
                                                                    ?.clientInfo
                                                                    ?.nom_tenant
                                                            }}&nbsp;]
                                                        </b>
                                                        <p
                                                            class="text-secondary fs-6"
                                                        >
                                                            <span
                                                                class="fw-bolder"
                                                                >Compte
                                                                client&nbsp;: </span
                                                            >{{
                                                                detailsInvoiceForm
                                                                    ?.clientInfo
                                                                    ?.compte_client ??
                                                                    'N/A'
                                                            }}<br />
                                                            <span
                                                                class="fw-bolder"
                                                                >Adresse&nbsp;: </span
                                                            >{{
                                                                detailsInvoiceForm
                                                                    ?.clientInfo
                                                                    ?.adresse ??
                                                                    'N/A'
                                                            }}<br />
                                                            <span
                                                                class="fw-bolder"
                                                                >Contact&nbsp;: </span
                                                            >{{
                                                                detailsInvoiceForm
                                                                    ?.clientInfo
                                                                    ?.contact_admin_tenant ??
                                                                    'N/A'
                                                            }}
                                                        </p>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td class="text-center">
                                                        <b>{{
                                                            'NUMBER_REFERENCE'
                                                                | translate
                                                        }}</b>
                                                    </td>
                                                    <td class="text-center">
                                                        <b>
                                                            <span
                                                                *ngIf="detailsInvoiceForm?.['reference']"
                                                                >Date de la
                                                                facture</span
                                                            >
                                                            <span
                                                                *ngIf="!detailsInvoiceForm?.['reference'] && detailsInvoiceForm?.['etat_paiement']"
                                                                >Date de la
                                                                proforma</span
                                                            >
                                                        </b>
                                                    </td>
                                                    <td
                                                        class="text-center"
                                                        *ngIf="detailsInvoiceForm?.['reference']"
                                                    >
                                                        <b>Date limite</b>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td class="text-center">
                                                        {{ detailsInvoiceForm?.['reference'] ??
                                                        detailsInvoiceForm?.['numero_demande'] }}
                                                    </td>
                                                    <td class="text-center">
                                                        {{
                                                            detailsInvoiceForm?.created_at ??
                                                                'N/A'
                                                        }}
                                                    </td>
                                                    <td
                                                        class="text-center"
                                                        *ngIf="detailsInvoiceForm?.['reference']"
                                                    >
                                                        <b>{{
                                                            detailsInvoiceForm?.date_limite ??
                                                                'N/A'
                                                        }}</b>
                                                    </td>
                                                    <td
                                                        class="align-middle text-start"
                                                    >
                                                        <b class="fs-5">
                                                            Suivi par [&nbsp;{{
                                                                detailsInvoiceForm
                                                                    ?.approbateur
                                                                    ?.nom
                                                            }}&nbsp;{{
                                                                detailsInvoiceForm
                                                                    ?.approbateur
                                                                    ?.prenoms
                                                            }}&nbsp;]&nbsp; [{{
                                                                detailsInvoiceForm
                                                                    ?.approbateur
                                                                    ?.email
                                                            }}]
                                                        </b>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="row px-5 pt-5">
                                    <div
                                        class="col-12"
                                        [formGroup]="formTypePaiement"
                                    >
                                        <div
                                            class="alert alert-dark p-1"
                                            role="alert"
                                            *ngIf="
                                                urlParamRef === 'view-invoice'
                                            "
                                        >
                                            <div
                                                class="d-flex gap-4 justify-content-center"
                                            >
                                                <span
                                                    class="d-flex align-items-center"
                                                >
                                                    La facture a été réglée
                                                    intégralement par le client,
                                                    avec un reçu de paiement
                                                    disponible.
                                                </span>
                                                <span class="d-flex gap-4">
                                                    <button
                                                        *ngIf="
                                                            displayButtonShowPaymentReceipt
                                                        "
                                                        pButton
                                                        pRipple
                                                        icon="pi pi-download"
                                                        class="p-button-success"
                                                        (click)="
                                                            onDownloadPaymentReceipt()
                                                        "
                                                    ></button>
                                                </span>
                                            </div>
                                        </div>

                                        <table
                                            [ngClass]="['native_table table']"
                                            *ngIf="
                                                urlParamRef !== 'view-invoice'
                                            "
                                        >
                                            <thead
                                                class="text-white"
                                                style="background-color: #000"
                                            >
                                                <tr>
                                                    <th
                                                        class="text-center"
                                                        style="
                                                            border: 2px solid
                                                                #fff;
                                                        "
                                                    >
                                                        <b>Choix</b>
                                                    </th>
                                                    <th
                                                        class="text-center"
                                                        style="
                                                            border: 2px solid
                                                                #fff;
                                                        "
                                                    >
                                                        <b>Mode de paiement</b>
                                                    </th>
                                                    <th class="text-center">
                                                        <b>DESCRIPTION</b>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="text-center">
                                                        <input
                                                            class="form-check-input"
                                                            type="radio"
                                                            name="type_paiement"
                                                            value="Post-Paid"
                                                            formControlName="type_paiement"
                                                            #differe
                                                        />
                                                    </td>
                                                    <td class="text-center h4">
                                                        PostPaid
                                                    </td>
                                                    <td class="text-start">
                                                        Le montant de cette
                                                        facture sera enregistré
                                                        dans le système de
                                                        facturation et réglé
                                                        ultérieurement selon les
                                                        conditions de paiement
                                                        convenues.
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="text-center">
                                                        <input
                                                            class="form-check-input"
                                                            type="radio"
                                                            name="type_paiement"
                                                            value="Pre-Paid"
                                                            formControlName="type_paiement"
                                                            #immediat
                                                            id="immediat"
                                                        />
                                                    </td>
                                                    <td class="text-center h4">
                                                        PrePaid
                                                    </td>
                                                    <td class="text-center">
                                                        <div
                                                            class="d-flex gap-4"
                                                        >
                                                            <span
                                                                class="d-flex align-items-center"
                                                            >
                                                                Un justificatif
                                                                de paiement
                                                                (reçu ou preuve
                                                                de virement) est
                                                                requis pour
                                                                procéder à la
                                                                validation de la
                                                                facture.
                                                            </span>
                                                            <span
                                                                class="d-flex gap-4"
                                                                *ngIf="
                                                                    immediat?.checked
                                                                "
                                                            >
                                                                <input
                                                                    type="file"
                                                                    accept="image/png,image/jpeg"
                                                                    style="
                                                                        padding: 0.5rem;
                                                                        border: 1px
                                                                            solid
                                                                            #000;
                                                                        border-radius: 0.2rem;
                                                                        color: #000;
                                                                    "
                                                                    (change)="
                                                                        onUploadPaymentReceipt(
                                                                            $event
                                                                                .target
                                                                                .files
                                                                        )
                                                                    "
                                                                />
                                                                <button
                                                                    pButton
                                                                    pRipple
                                                                    icon="pi pi-download"
                                                                    class="p-button-success"
                                                                    (click)="
                                                                        onDownloadPaymentReceipt()
                                                                    "
                                                                    *ngIf="
                                                                        displayButtonShowPaymentReceipt
                                                                    "
                                                                ></button>
                                                            </span>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="text-center">
                                                        <input
                                                            class="form-check-input"
                                                            type="radio"
                                                            name="type_paiement"
                                                            value="via Compte"
                                                            formControlName="type_paiement"
                                                            #differe
                                                        />
                                                    </td>
                                                    <td class="text-center h4">
                                                        via mon compte
                                                    </td>
                                                    <td class="text-start">
                                                        Le montant de cette
                                                        facture sera
                                                        automatiquement prélevé
                                                        de votre compte client.
                                                        <br />
                                                        &nbsp;[
                                                        <b>Solde engagé</b> :
                                                        <span
                                                            class="badge badge-dark"
                                                            style="
                                                                font-size: 16px;
                                                            "
                                                        >
                                                            {{
                                                                detailsInvoiceForm?.SoldeEngage ||
                                                                    0
                                                            }}
                                                            Fcfa
                                                        </span>
                                                        &nbsp;|
                                                        <b>Solde restant</b> :
                                                        <span
                                                            class="badge badge-primary"
                                                            style="
                                                                font-size: 16px;
                                                            "
                                                        >
                                                            {{
                                                                detailsInvoiceForm?.SoldeRestant ||
                                                                    0
                                                            }}
                                                            <span
                                                                *ngIf="
                                                                    +detailsInvoiceForm?.SoldeRestant >
                                                                    0
                                                                "
                                                            >
                                                                Fcfa</span
                                                            >
                                                        </span>
                                                        &nbsp;|
                                                        <b>Solde disponible</b>
                                                        :
                                                        <span
                                                            class="badge badge-success"
                                                            style="
                                                                font-size: 16px;
                                                            "
                                                        >
                                                            {{
                                                                detailsInvoiceForm?.soldeDisponible ||
                                                                    0
                                                            }}
                                                            Fcfa
                                                        </span>
                                                        ]
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="row" style="padding: 20px 45px">
                                    <div class="col-12">
                                        <br />
                                        <table
                                            class="table table-bordered border-secondary"
                                        >
                                            <thead
                                                class="bg-primary text-white"
                                            >
                                                <tr>
                                                    <th>Code</th>
                                                    <th>Désignation</th>
                                                    <th class="text-center">
                                                        Quantité
                                                    </th>
                                                    <th class="text-center">
                                                        P.U. (FCFA)
                                                    </th>
                                                    <th class="text-center">
                                                        Montant (FCFA)
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr style="border-color: black">
                                                    <td>
                                                        {{
                                                            detailsInvoiceForm?.numero_demande ??
                                                                'N/A'
                                                        }}
                                                    </td>
                                                    <td>
                                                        <b>{{
                                                            formatTitle(
                                                                detailsInvoiceForm?.operation
                                                            )
                                                        }}</b>
                                                    </td>
                                                    <td class="text-center">
                                                        {{
                                                            detailsInvoiceForm?.qte
                                                        }}
                                                    </td>
                                                    <td class="text-center">
                                                        {{
                                                            detailsInvoiceForm?.prix_unitaire
                                                        }}
                                                    </td>
                                                    <td
                                                        class="text-center fs-6"
                                                    >
                                                        {{
                                                            detailsInvoiceForm?.prix_ht
                                                        }}
                                                    </td>
                                                </tr>

                                                <tr
                                                    class="tr_montant"
                                                    style="
                                                        border-color: transparent;
                                                    "
                                                >
                                                    <td colspan="3"></td>
                                                    <td class="text-center">
                                                        Montant total (HT)
                                                    </td>
                                                    <td
                                                        class="text-center fs-6"
                                                    >
                                                        {{
                                                            detailsInvoiceForm?.prix_ht
                                                        }}
                                                    </td>
                                                </tr>

                                                <tr
                                                    class="tr_montant"
                                                    style="
                                                        border-color: transparent;
                                                    "
                                                >
                                                    <td colspan="3"></td>
                                                    <td class="text-center">
                                                        Montant TVA ({{
                                                            detailsInvoiceForm?.tva
                                                        }}%)
                                                    </td>
                                                    <td
                                                        class="text-center fs-6"
                                                    >
                                                        {{
                                                            detailsInvoiceForm?.prix_tva
                                                        }}
                                                    </td>
                                                </tr>

                                                <tr
                                                    class="tr_montant"
                                                    style="
                                                        border-color: transparent;
                                                    "
                                                >
                                                    <td colspan="3"></td>
                                                    <td class="text-center">
                                                        <b
                                                            >Montant total
                                                            (TTC)</b
                                                        >
                                                    </td>
                                                    <td
                                                        class="text-center fs-6"
                                                    >
                                                        <b>{{
                                                            detailsInvoiceForm?.prix_ttc
                                                        }}</b>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div
                                    class="d-flex justify-content-center py-10"
                                >
                                    <p class="fs-6">
                                        Arrêté
                                        <span
                                            *ngIf="detailsInvoiceForm?.['reference']"
                                            >cette facture</span
                                        >
                                        <span
                                            *ngIf="detailsInvoiceForm?.['etat_paiement']"
                                            >ce proforma</span
                                        >
                                        à la somme de
                                        <span class="text-primary">{{
                                            detailsInvoiceForm?.prix_ttc_lettres
                                        }}</span>
                                        Fcfa TTC sauf erreur
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div
                            class="d-flex justify-content-center align-items-center"
                            style="height: 100vh"
                            *ngIf="spinner"
                        >
                            <p-progressSpinner
                                ariaLabel="loading"
                            ></p-progressSpinner>
                        </div>
                    </div>

                    <div *ngIf="displayUrlErrorPage">
                        <div>
                            <div class="d-flex justify-content-end">
                                <p-button
                                    label="Fermer"
                                    styleClass="p-button-danger"
                                    (click)="onGoToBack()"
                                >
                                </p-button>
                            </div>
                        </div>
                        <div
                            class="d-flex justify-content-center align-items-center text-danger"
                        >
                            page not available
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
