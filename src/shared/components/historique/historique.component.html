<p-table #dt [value]="listHistoriques" [rows]="10" [paginator]="true" [globalFilterFields]="['created_at', 'nom']"
    responsiveLayout="scroll" [rowHover]="true" dataKey="id" currentPageReportTemplate="Affichage de {first} à {last} des {totalRecords}
    données" [showCurrentPageReport]="true">
    <ng-template pTemplate="caption">
        <div class="row">
            <div class="col-md-3">
                <label class="block"><b>Date début <span class="text-danger">*</span></b></label>
                <p-calendar [ngStyle]="{width: '21rem'}" [(ngModel)]="filterDateStart" [showIcon]="true"
                    (ngModelChange)="
                    changeDateStart($event)" dateFormat="dd-mm-yy"></p-calendar>
            </div>
            <div class="col-md-3">
                <label class="block"><b>Date fin <span class="text-danger">*</span></b></label>
                <p-calendar [ngStyle]="{width: '21rem'}" [(ngModel)]="filterDateEnd" [showIcon]="true"
                    (ngModelChange)="changeDateEnd($event)" dateFormat="dd-mm-yy"></p-calendar>
            </div>
            <div class="col-md-3">
                <label class="block"><b>Utilisateur </b></label>
                <p-dropdown [options]="listUsers" [(ngModel)]="currentUser" optionLabel="fullName" [filter]="true"
                    filterBy="nom" [showClear]="true" placeholder="Selectionner l'utilisateur">
                    <ng-template let-data pTemplate="item">
                        <div class="country-item">
                            <div>{{ data.fullName }}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>
            <div class="col-md-1">
                <label class="no__opacity block"><b></b>Actions</label>
                <p-button [style]="{'height':'60%'}" styleClass="p-button-success" icon="pi pi-filter"
                    (click)="filterHistoriques()"></p-button>
            </div>
        </div>
        <div class="header-table">
            <div class="pt-3">
                <h4><b>Liste des Historiques</b></h4>
            </div>
            <div>
                <span class="p-input-icon-left">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" placeholder="Rechercher" />
                </span>
            </div>
        </div>
    </ng-template>
    <ng-template pTemplate="header">
        <tr>
            <th>#</th>
            <th>Source [Utilisteur]</th>
            <th>Module</th>
            <th>Sous Module</th>
            <th>Action</th>
            <th class="text-center">Date</th>
            <th class="text-center">Action</th>
        </tr>
    </ng-template>
    <ng-template let-i="rowIndex" pTemplate="body" let-historique>
        <tr>
            <td>{{ i + 1 }}</td>
            <td>{{ historique.ip }} [{{historique?.user.nom +' ' +historique?.user.prenoms}}]</td>
            <td>{{historique.module === null? 'N/A': historique?.module}}</td>
            <td class="text-center">{{historique?.sous_module === null? 'N/A': historique?.sous_module}}</td>
            <td>{{historique.action === null? 'N/A': historique.action}}</td>
            <td class="text-center">{{historique.created_at === null? 'N/A': historique.created_at}}</td>
            <td class="text-center">

                <button pButton pRipple label="Voir" class="p-button-dark"
                    (click)="showHistorique(content,historique)"></button>
            </td>
        </tr>
    </ng-template>
</p-table>
<ng-template #content let-modal [ngClass]="'modal-content'">
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Vue Globale des Activités</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
        <div class="ressource_wrapper">
            <div class="identification">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>
                                <b>Utilisateur</b>
                            </label>
                            <input type="text" [placeholder]="currentEvent?.user.nom+' '+currentEvent?.user.prenoms"
                                [disabled]="true" pInputText />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>
                                <b>Module</b>
                            </label>
                            <input type="text" [placeholder]="currentEvent?.sous_module" [disabled]="true" pInputText />
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="form-group">
                        <label>
                            <b>Description</b>
                        </label>
                        <textarea class="form-control" [placeholder]="currentEvent?.action" [disabled]="true"
                            rows="3"></textarea>
                    </div>
                </div>
            </div>
            <div class="global">
                <div class="global_wrapper">
                    <div class="label">Type</div>
                    <div class="value">{{currentEvent?.modele_type}}</div>
                </div>
                <div class="global_wrapper">
                    <div class="label">Event</div>
                    <div class="value">{{currentEvent?.event}}</div>
                </div>
                <div class="global_wrapper">
                    <div class="label">Event</div>
                    <div class="value">{{currentEvent?.updated_at}}</div>
                </div>
            </div>
        </div>
        <div class="table_wrapper" *ngIf="currentEvent?.event === 'MISE A JOUR'">
            <table [ngClass]="['native_table table']">
                <thead>
                    <th style="width: 35rem;">Key</th>
                    <th>Before</th>
                    <th>After</th>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 0 !important;">
                    <tr style="display: flex;flex-direction: column;">
                        <td style="text-align: left;text-transform: capitalize;font-weight: 600;"
                            *ngFor="let item of this.currentEventParse?.after | keyvalue">
                            {{item.key}}</td>
                    </tr>
                    </td>
                    <td style="padding: 0 !important;">
                        <tr style="display: flex;flex-direction: column;">
                            <td style="text-align: left;text-transform: capitalize;font-weight: 600;"
                                *ngFor="let item of this.currentEventParse?.after | keyvalue">
                                {{item.value ? item.value : 'N/A'}}</td>
                        </tr>
                    </td>
                    <td style="padding: 0 !important;">
                        <tr style="display: flex;flex-direction: column;">
                            <td style="text-align: left;text-transform: capitalize;font-weight: 600;"
                                *ngFor="let item of this.currentEventParse?.before | keyvalue">
                                {{item.value ? item.value : 'N/A'}}</td>
                        </tr>
                    </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="modal-footer"></div>
</ng-template>