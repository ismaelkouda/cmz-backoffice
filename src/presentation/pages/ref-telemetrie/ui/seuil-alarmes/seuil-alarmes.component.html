<div class="container-fluid">
  <div class="col-sm-12">
    <app-breadcrumb [title]="'Refrentiel Supervision'" [active_item]="'Indicateurs & Alarmes'"></app-breadcrumb>
    <div class="card">
      <div class="card-body">
        <div>
          <p-tabView (onChange)="handleChangeTabviewIndex($event)">
            <p-tabPanel header="INDICATEURS & ALARMES">
              <div class="table_actions_wrapper" style="display: flex;justify-content: space-between;">
                <div>
                  <button pButton pRipple label="Exporter" (click)="OnExportExcel()" [disabled]="disableAction()" icon="pi pi-download"
                    class="p-button-helf"></button>
                  <button pButton pRipple label="Enregistrer" (click)="handleUpdateReferentielTelemetrie()"
                    [disabled]="isValidate()" icon="pi pi-save" class="p-button-success ms-3"></button>
                </div>
              </div>
              <div class="table_content_wrapper">
                <p-table #dt [value]="listTelemetries" [rows]="10" [paginator]="true" responsiveLayout="scroll"
                  [rowHover]="true" dataKey="id"
                  currentPageReportTemplate="Affichage de {first} à {last} des {totalRecords}données"
                  [showCurrentPageReport]="true" editMode="row">
                  <ng-template pTemplate="caption">
                    <div class="table_header">
                      <app-table-header [count]="listTelemetries" [legende]="'Indicateurs et Alarmes'"></app-table-header>
                      <div class="table_header__input" style="position: relative;left: 1rem;">
                        <span class="p-input-icon-left ml-auto">
                          <i class="pi pi-search"></i>
                          <input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')"
                            placeholder="Recherche" />
                        </span>
                      </div>
                    </div>
                  </ng-template>
                  <ng-template pTemplate="header">
                    <tr>
                      <th class="text-center">#</th>
                      <th class="text-center">Services</th>
                      <th>Description mésure</th>
                      <th class="text-center">Type de mesure</th>
                      <th class="text-center">Unité</th>
                      <th style="width: 2rem;" class="text-center">Actions</th>
                    </tr>
                  </ng-template>
                  <ng-template let-i="rowIndex" pTemplate="body" let-editing="editing" let-data>
                    <tr [pEditableRow]="data">
                      <td class="text-center">{{ i + 1 }}</td>
                      <td class="text-center">{{data?.classification}}</td>
                      <td>{{data?.description}}</td>
                      <td class="text-center">{{data?.type_mesure}}</td>
                      <td style="width: 5rem !important;text-align: center;">
                        <p-cellEditor>
                          <ng-template pTemplate="input">
                            <input *ngIf="data?.classification !== 'data'" class="text-center" pInputText
                              [(ngModel)]="data.unite" #data.unite="ngModel" />
                            <p-dropdown [options]="['ko','Mo','Go','To']" *ngIf="data?.classification === 'data'"
                              appendTo="body" [(ngModel)]="data.unite" #data.unite="ngModel"></p-dropdown>
                          </ng-template>
                          <ng-template pTemplate="output">
                            <span>{{ data.unite }}</span>
                          </ng-template>
                        </p-cellEditor>
                      </td>
                      <td class="td-actions">
                        <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow pTooltip="Modifier"
                          tooltipPosition="top" icon="pi pi-pencil" (click)="OnEditOneRowMetrique(data)"
                          class="p-button-secondary"></button>
                        <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow pTooltip="Sauvegarder"
                          tooltipPosition="top" icon="pi pi-check" (click)="onRowEditMetriqueSave(data)"
                          class="p-button-success"></button>
                        <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow pTooltip="Fermer"
                          tooltipPosition="top" icon="pi pi-times" (click)="onCancelRowMetrique(data, i)"
                          class="p-button-danger" style="margin-left: 1rem"></button>
                      </td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
            </p-tabPanel>
            <p-tabPanel header="HISTORIQUE">
              <app-historique [module]="'PROFIL SUPERVISION'" [modele]="'metriques'"></app-historique>
            </p-tabPanel>
          </p-tabView>
        </div>
      </div>
    </div>
  </div>
</div>