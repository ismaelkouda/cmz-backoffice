<div class="container-fluid">
  <div class="col-sm-12">
    <app-breadcrumb [title]="'Refrentiel Supervision'" [active_item]="'Objectif SLA'"></app-breadcrumb>
    <div class="card">
      <div class="card-body">
        <div>
          <p-tabView (onChange)="handleChangeTabviewIndex($event)">
            <p-tabPanel header="OBJECTIF SLA">
              <div class="table_actions_wrapper" style="display: flex;justify-content: space-between;">
                <div>
                  <button pButton pRipple label="Exporter" [disabled]="disableAction()" icon="pi pi-download"
                    class="p-button-helf" (click)="OnExportExcel()"></button>
                  <button pButton pRipple label="Enregistrer" (click)="handleUpdateReferentielTelemetrie()"
                    [disabled]="globalMetriquesEditRow.length === 0" icon="pi pi-save"
                    class="p-button-success ms-3"></button>
                </div>
                <div>
                </div>
              </div>
              <div class="table_content_wrapper">
                <p-table #dt [value]="listObjectifs" [rows]="10" [paginator]="true" responsiveLayout="scroll"
                  [rowHover]="true" dataKey="id"
                  currentPageReportTemplate="Affichage de {first} à {last} des {totalRecords}données"
                  [showCurrentPageReport]="true" editMode="row">
                  <ng-template pTemplate="caption">
                    <div class="table_header">
                      <div class="table_header__legende" style="position: relative;left: -1rem;">
                        <h4>
                          <b>Liste des Objectifs SLA</b>
                        </h4>
                      </div>
                      <div class="table_header__input" style="position: relative;left: 1rem;">
                        <span class="p-input-icon-left ml-auto">
                          <i class="pi pi-search"></i>
                          <input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')"
                            placeholder="Recherche" />
                        </span>
                      </div>
                    </div>
                  </ng-template>
                  <ng-template pTemplate="header">
                    <tr>
                      <th class="text-center">#</th>
                      <th class="text-center">Nom du service</th>
                      <th>Description du service</th>
                      <th class="text-center"><span style="margin-right: 5px">ACK</span>(h)</th>
                      <th class="text-center"><span style="margin-right: 5px">Traitement</span>(h)</th>
                      <th class="text-center"><span style="margin-right: 5px">Clôture</span>(h)</th>
                      <th class="text-center">Statut</th>
                      <th style="width: 2rem;" class="text-center">Actions</th>
                    </tr>
                  </ng-template>
                  <ng-template let-i="rowIndex" pTemplate="body" let-editing="editing" let-data>
                    <tr [pEditableRow]="data">
                      <td class="text-center">{{ i + 1 }}</td>
                      <td class="text-center">{{data?.nom_service}}</td>
                      <td>{{data?.description_service}}</td>
                      <td class="text-center" style="width: 4rem !important;">
                        <p-cellEditor>
                          <ng-template pTemplate="input">
                            <input class="text-center" pInputText type="number" [(ngModel)]="data.delai_akc"
                              #data.delai_akc="ngModel" />
                          </ng-template>
                          <ng-template pTemplate="output">
                            <span>{{ data.delai_akc }}</span>
                          </ng-template>
                        </p-cellEditor>
                      </td>
                      <td class="text-center" style="width: 4rem !important;">
                        <p-cellEditor>
                          <ng-template pTemplate="input">
                            <input class="text-center" pInputText type="number" [(ngModel)]="data.delai_traitement"
                              #data.delai_traitement="ngModel" />
                          </ng-template>
                          <ng-template pTemplate="output">
                            <span>{{ data.delai_traitement }}</span>
                          </ng-template>
                        </p-cellEditor>
                      </td>
                      <td class="text-center" style="width: 4rem !important;">
                        <p-cellEditor>
                          <ng-template pTemplate="input">
                            <input class="text-center" pInputText type="number" [(ngModel)]="data.delai_cloture"
                              #data.delai_cloture="ngModel" />
                          </ng-template>
                          <ng-template pTemplate="output">
                            <span>{{ data.delai_cloture }}</span>
                          </ng-template>
                        </p-cellEditor>
                      </td>
                      <td class="text-center" style="width: 4rem !important;">
                        <p-cellEditor>
                          <ng-template pTemplate="input">
                            <p-inputSwitch trueValue="actif" falseValue="inactif" [(ngModel)]="data.statut"
                              #data.statut="ngModel"></p-inputSwitch>
                          </ng-template>
                          <ng-template pTemplate="output">
                            <span [ngStyle]="{ 'font-size': '16px'}" class="badge text-center"
                              [class.badge-success]="data.statut === 'actif'"
                              [class.badge-danger]="data.statut !== 'actif'">
                              {{ data.statut }}
                            </span>
                          </ng-template>
                        </p-cellEditor>
                      </td>
                      <td class="td-actions">
                        <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow pTooltip="Modifier"
                          tooltipPosition="top" icon="pi pi-pencil" (click)="OnEditOneRowMetrique(data)"
                          class="p-button-secondary"></button>
                        <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow pTooltip="Sauvegarder"
                          tooltipPosition="top" icon="pi pi-check" (click)="onRowEditMetriqueSave(data)"
                          class="p-button-success"></button>
                        <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow pTooltip="Fermer"
                          tooltipPosition="top" icon="pi pi-times" (click)="onCancelRowMetrique(data, i)"
                          class="p-button-danger" style="margin-left: 1rem"></button>
                      </td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
            </p-tabPanel>
            <p-tabPanel header="HISTORIQUE">
              <app-historique [module]="'PROFIL SUPERVISION'" [modele]="'metriques'"></app-historique>
            </p-tabPanel>
          </p-tabView>
        </div>
      </div>
    </div>
  </div>
</div>