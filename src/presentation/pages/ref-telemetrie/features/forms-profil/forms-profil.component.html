<div style="margin-top: -2rem !important; display: flex">
    <app-patrimoine-header
        [displayDate]="false"
        [displayList]="true"
        [legendePluriel]="'alarmes'"
        [legendeSingulier]="'alarme'"
    >
    </app-patrimoine-header>
    <span class="table-header-wrapper d-flex align-items-center">
        <b>
            [<span
                class="text-orange fs-4"
                >{{currentObject?.["nom"] | uppercase}}</span
            >]
            <!-- [<span class="text-orange fs-4">{{selectedDossier?.["numero_demande"]}}</span>]
            [<span class="text-orange">{{selectedDossier?.["nom_tenant"]}}</span>]
            [<span class="text-orange fs-4">{{selectedDossier?.['demandeur_nom']}} {{selectedDossier?.['demandeur_prenoms']}}</span>]
            [<span [class]="'badge ' + getEtapeBadge(selectedDossier)" [ngStyle]="{ width: 'fit-content', 'font-size': '18px' }">{{selectedDossier?.['statut']}}</span> |
            <span [class]="'badge ' + getEtatBadge(selectedDossier)" [ngStyle]="{ width: 'fit-content', 'font-size': '18px' }">{{selectedDossier?.['traitement']  === BADGE_ETAT.COMPLET ? 'complet' : selectedDossier?.['traitement']}}</span>] -->
        </b>
    </span>
</div>
<div>
    <div class="container_flex_space_between">
        <div
            class="row filter_wrapper"
            [formGroup]="adminForm"
            style="width: 100%"
        >
            <div class="col-md-3">
                <div class="form-group">
                    <label>
                        <b>Nom du profil<span class="text-danger">*</span></b>
                    </label>
                    <input
                        placeholder="Nom du Profil"
                        formControlName="nom"
                        type="text"
                        pInputText
                    />
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>
                        <b>Description<span class="text-danger">*</span></b>
                    </label>
                    <input
                        placeholder="Description du Profil"
                        [ngStyle]="{
                            height:
                                !this.currentObject?.show && this.currentObject
                                    ? '3.5rem'
                                    : 'inherit'
                        }"
                        formControlName="description"
                        type="text"
                        pInputText
                    />
                </div>
            </div>
        </div>
        <div>
            <div class="table_actions_wrapper pt-3">
                <div *ngIf="!this.currentObject">
                    <button
                        pButton
                        pRipple
                        label="Soumettre"
                        [disabled]="isValidate()"
                        icon="pi pi-save"
                        class="p-button-success"
                        (click)="handleSaveProfilSupervision()"
                    ></button>
                </div>
                <div *ngIf="this.currentObject">
                    <button
                        pButton
                        pRipple
                        label="Soumettre"
                        [disabled]="this.currentObject?.show || isValidate()"
                        icon="pi pi-save"
                        class="p-button-success"
                        (click)="handleUpdateProfilSupervision()"
                    ></button>
                </div>
                <div>
                    <button
                        pButton
                        pRipple
                        label="Fermer"
                        (click)="close()"
                        class="p-button-danger"
                    ></button>
                </div>
            </div>
        </div>
    </div>

    <!-- <div [formGroup]="formFilter">
        <div class="d-flex gap-1">
            <div class="width-100">
                <label><b>{{ firstLevelLibelle }}</b></label>
                <p-dropdown [options]="listFirstLeveDatas" optionLabel="fullName"
                    (onChange)="onChangeFirstLvel($event.value)" [showClear]="true" [filter]="true" filterBy="fullName"
                    [placeholder]="firstLevelLibelle" optionValue="uuid" formControlName="niveau_un_uuid"
                    [ngStyle]="{ width: '100%' }">
                </p-dropdown>
            </div>
            <div class="width-100">
                <label><b>{{ secondLevelLibelle }}</b></label>
                <p-dropdown [options]="listSecondLevelDatas" optionLabel="fullName" [filter]="true" [showClear]="true"
                    formControlName="niveau_deux_uuid" [placeholder]="secondLevelLibelle" optionValue="uuid"
                    [ngStyle]="{ width: '100%' }">
                </p-dropdown>
            </div>
            <div class="width-80">
                <label><b>MSISDN</b></label>
                <input placeholder="MSISDN" formControlName="msisdn" type="text" pInputText
                    [ngStyle]="{ width: '100%' }" />
            </div>
            <div class="width-80">
                <label><b>IMSI</b></label>
                <input placeholder="IMSI" formControlName="imsi" type="text" pInputText [ngStyle]="{ width: '100%' }" />
            </div>
            <div class="width-80">
                <label><b>APN</b></label>
                <input placeholder="apn" formControlName="apn" type="text" pInputText [ngStyle]="{ width: '100%' }" />
            </div>
            <div class="width-80">
                <label><b>Adresse IP</b></label>
                <input placeholder="Adresse IP" formControlName="adresse_ip" type="text" pInputText
                    [ngStyle]="{ width: '100%' }" />
            </div>
            <div [ngStyle]="{ width: 'auto' }" *ngIf="!secondFilter">
                <label [ngStyle]="{ opacity: '0' }">Actions</label> <br />
                <p-button styleClass="p-button-success" icon="pi pi-filter"
                    (click)="GetAllReferentielTelemetrie()"></p-button>
            </div>
            <div [ngStyle]="{ width: 'auto' }">
                <label [ngStyle]="{ opacity: '0' }">Actions</label> <br />
                <p-button *ngIf="!secondFilter" (click)="showSecondFilter()" styleClass="p-button-dark"
                    icon="pi pi-plus"></p-button>
                <p-button *ngIf="secondFilter" (click)="showSecondFilter()" styleClass="p-button-dark"
                    icon="pi pi-minus"></p-button>
            </div>
        </div>
        <div class="d-flex gap-1" style="padding-top: 0.7rem" *ngIf="secondFilter">
            <div class="width-100">
                <label><b>Usage</b></label>
                <p-dropdown [options]="listUsages" formControlName="usage_id" optionLabel="nom_usage" [showClear]="true"
                    [placeholder]="'Usage'" optionValue="id" [ngStyle]="{ width: '100%' }">
                </p-dropdown>
            </div>
            <div class="width-100">
                <label><b>Formule</b></label>
                <p-dropdown [options]="listFormule" formControlName="formule_uuid" optionLabel="nom" [showClear]="true"
                    [placeholder]="'Formule'" optionValue="uuid" [ngStyle]="{ width: '100%' }">
                </p-dropdown>
            </div>
            <div class="width-100">
                <label><b>{{ thirdLevelLibelle }}</b></label>
                <p-dropdown [options]="listThirdLevelDatas" formControlName="niveau_trois_uuid" optionLabel="nom"
                    [showClear]="true" [placeholder]="thirdLevelLibelle" optionValue="uuid"
                    [ngStyle]="{ width: '100%' }">
                </p-dropdown>
            </div>
            <div class="width-100">
                <label><b>Nom Emplacement</b></label>
                <input placeholder="Emplacement" formControlName="point_emplacement" type="text" pInputText
                    [ngStyle]="{ width: '100%' }" />
            </div>
            <div class="width-100">
                <label>
                    <b>Zone Trafic</b>
                </label>
                <input placeholder="zone" formControlName="zone_trafic" type="text" pInputText
                    [ngStyle]="{ width: '100%' }" />
            </div>
            <div class="p-0 d-flex align-items-end justify-content-end" [ngStyle]="{ width: '4rem' }">
                <p-button styleClass="p-button-success" icon="pi pi-filter"
                    (click)="GetAllReferentielTelemetrie()"></p-button>
            </div>
        </div>
    </div> -->

    <hr />

    <div class="table_content_wrapper" *ngIf="currentObject === undefined">
        <p-table
            #dt
            [value]="listTelemetries"
            [rows]="10"
            [paginator]="true"
            responsiveLayout="scroll"
            [rowHover]="true"
            dataKey="id"
            currentPageReportTemplate="Affichage de {first} à {last} des {totalRecords}
                données"
            [showCurrentPageReport]="true"
            editMode="row"
        >
            <ng-template pTemplate="caption">
                <div class="table_header">
                    <div class="table_header__legende">
                        <app-table-header
                            [count]="listTelemetries"
                            [legende]="'Seuils et Alarmes'"
                        ></app-table-header>
                    </div>
                    <div class="table_header__input">
                        <span class="p-input-icon-left ml-auto">
                            <i class="pi pi-search"></i>
                            <input
                                pInputText
                                type="text"
                                (input)="
                                    dt1.filterGlobal(
                                        $event.target.value,
                                        'contains'
                                    )
                                "
                                placeholder="Recherche"
                            />
                        </span>
                    </div>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th>#</th>
                    <th>Classification</th>
                    <th>Description mésure</th>
                    <th>Type de mesure</th>
                    <th>Unité</th>
                    <th>Seuil</th>
                    <th>Statut</th>
                    <th style="width: 2rem" class="text-center">Actions</th>
                </tr>
            </ng-template>
            <ng-template
                let-i="rowIndex"
                pTemplate="body"
                let-editing="editing"
                let-data
            >
                <tr [pEditableRow]="data">
                    <td class="text-center">{{ i + 1 }}</td>
                    <td class="text-center">{{ data?.classification }}</td>
                    <td>{{ data?.description }}</td>
                    <td class="text-center">{{ data?.type_mesure }}</td>
                    <td class="text-center">{{ data?.unite }}</td>
                    <td style="width: 4rem">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input
                                    class="text-center"
                                    pInputText
                                    type="number"
                                    [(ngModel)]="data.seuil"
                                    #data.seuil="ngModel"
                                />
                            </ng-template>
                            <ng-template pTemplate="output">
                                <span>{{ data.seuil }}</span>
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="width: 4rem">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-inputSwitch
                                    trueValue="actif"
                                    falseValue="inactif"
                                    [(ngModel)]="data.statut"
                                    #data.statut="ngModel"
                                ></p-inputSwitch>
                            </ng-template>
                            <ng-template pTemplate="output">
                                <span
                                    [ngStyle]="{ 'font-size': '16px' }"
                                    class="badge"
                                    [class.badge-success]="
                                        data.statut === 'actif'
                                    "
                                    [class.badge-danger]="
                                        data.statut !== 'actif'
                                    "
                                >
                                    {{ data.statut }}
                                </span>
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td class="td-actions">
                        <button
                            *ngIf="!editing"
                            pButton
                            pRipple
                            type="button"
                            pInitEditableRow
                            pTooltip="Modifier"
                            tooltipPosition="top"
                            icon="pi pi-pencil"
                            (click)="OnEditOneRowMetrique(data)"
                            class="p-button-secondary"
                        ></button>
                        <button
                            *ngIf="editing"
                            pButton
                            pRipple
                            type="button"
                            pSaveEditableRow
                            pTooltip="Sauvegarder"
                            tooltipPosition="top"
                            icon="pi pi-check"
                            (click)="onRowEditMetriqueSave(data)"
                            class="p-button-success"
                        ></button>
                        <button
                            *ngIf="editing"
                            pButton
                            pRipple
                            type="button"
                            pCancelEditableRow
                            pTooltip="Fermer"
                            tooltipPosition="top"
                            icon="pi pi-times"
                            (click)="onCancelRowMetrique(data, i)"
                            class="p-button-danger"
                            style="margin-left: 1rem"
                        ></button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
    <p-tabView
        *ngIf="currentObject !== undefined"
        (onChange)="detailsCurrentTabPanelIndex = $event.index"
    >
        <p-tabPanel header="ALARMES DES SOLDES">
            <div *ngIf="indexTabPanelActive === 0">
                <div class="table_content_wrapper">
                    <p-table
                        #dt
                        [value]="listAffectations"
                        [rows]="10"
                        [paginator]="true"
                        responsiveLayout="scroll"
                        [rowHover]="true"
                        dataKey="id"
                        currentPageReportTemplate="Affichage de {first} à {last} des {totalRecords}
                        données"
                        [showCurrentPageReport]="true"
                        editMode="row"
                    >
                        <ng-template pTemplate="caption">
                            <div class="table_header">
                                <div class="table_header__legende">
                                    <app-table-header
                                        [count]="listAffectations"
                                        [legende]="'Seuils et Alarmes'"
                                    ></app-table-header>
                                </div>
                                <div class="d-flex gap-2">
                                    <!-- <div class="d-flex align-items-center">
                                        <button pButton pRipple label="Soumettre"
                                        [disabled]="this.currentObject?.show || isValidate()" icon="pi pi-save"
                                        class="p-button-success" (click)="handleUpdateProfilSupervision()"></button>
                                    </div> -->

                                    <div
                                        class="d-flex justify-content-end mt-3"
                                    >
                                        <app-search-table
                                            [dt]="dt"
                                        ></app-search-table>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="header">
                            <tr>
                                <th class="text-center">#</th>
                                <th>Classification</th>
                                <th>Description mésure</th>
                                <th>Type de mesure</th>
                                <th>Unité</th>
                                <th>Seuil</th>
                                <th>Statut</th>
                                <th *ngIf="!currentObject.show">Action</th>
                            </tr>
                        </ng-template>
                        <ng-template
                            let-i="rowIndex"
                            pTemplate="body"
                            let-editing="editing"
                            let-data
                        >
                            <tr [pEditableRow]="data">
                                <td class="text-center">{{ i + 1 }}</td>
                                <td class="text-center">
                                    {{ data?.classification }}
                                </td>
                                <td>{{ data?.description }}</td>
                                <td class="text-center">
                                    {{ data?.type_mesure }}
                                </td>
                                <td class="text-center">{{ data?.unite }}</td>
                                <td
                                    class="text-center"
                                    style="width: 4rem !important"
                                >
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input
                                                class="text-center"
                                                pInputText
                                                type="number"
                                                [(ngModel)]="data.seuil"
                                                #data.seuil="ngModel"
                                            />
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            <span>{{ data.seuil }}</span>
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td style="width: 4rem">
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-inputSwitch
                                                trueValue="actif"
                                                falseValue="inactif"
                                                [(ngModel)]="data.statut"
                                                #data.statut="ngModel"
                                            ></p-inputSwitch>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            <span
                                                [ngStyle]="{
                                                    'font-size': '16px'
                                                }"
                                                class="badge"
                                                [class.badge-success]="
                                                    data.statut === 'actif'
                                                "
                                                [class.badge-danger]="
                                                    data.statut !== 'actif'
                                                "
                                            >
                                                {{ data.statut }}
                                            </span>
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td
                                    class="text-center"
                                    *ngIf="!currentObject.show"
                                >
                                    <button
                                        *ngIf="!editing"
                                        pButton
                                        pRipple
                                        type="button"
                                        pInitEditableRow
                                        pTooltip="Modifier"
                                        tooltipPosition="top"
                                        icon="pi pi-pencil"
                                        (click)="OnEditOneRowMetrique(data)"
                                        class="p-button-secondary"
                                    ></button>
                                    <button
                                        *ngIf="editing"
                                        [disabled]="currentObject.show"
                                        pButton
                                        pRipple
                                        type="button"
                                        pSaveEditableRow
                                        pTooltip="Sauvegarder"
                                        tooltipPosition="top"
                                        icon="pi pi-check"
                                        (click)="onRowEditMetriqueSave(data)"
                                        class="p-button-success"
                                    ></button>
                                    <button
                                        *ngIf="editing"
                                        pButton
                                        pRipple
                                        type="button"
                                        pCancelEditableRow
                                        pTooltip="Fermer"
                                        tooltipPosition="top"
                                        icon="pi pi-times"
                                        (click)="onCancelRowMetrique(data, i)"
                                        class="p-button-danger"
                                        style="margin-left: 1rem"
                                    ></button>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </div>
        </p-tabPanel>
        <!-- <p-tabPanel header="SOLDE SMS">
            <div class="table_content_wrapper">
                <p-table #dt [value]="listSms" [rows]="10" [paginator]="true" responsiveLayout="scroll"
                    [rowHover]="true" dataKey="id" currentPageReportTemplate="Affichage de {first} à {last} des {totalRecords}
                    données" [showCurrentPageReport]="true" editMode="row">
                    <ng-template pTemplate="caption">
                        <div class="table_header">
                            <div class="table_header__legende">
                                <app-table-header [count]="listSms" [legende]="'Seuils et Alarmes'"></app-table-header>
                            </div>
                            <div class="d-flex gap-2">
                                <div class="d-flex justify-content-end mt-3">
                                    <app-search-table [dt]="dt"></app-search-table>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr>
                            <th class="text-center">#</th>
                            <th>Classification</th>
                            <th>Description mésure</th>
                            <th>Type de mesure</th>
                            <th>Unité</th>
                            <th>Seuil</th>
                            <th>Statut</th>
                            <th *ngIf="!currentObject.show">Action</th>
                        </tr>
                    </ng-template>
                    <ng-template let-i="rowIndex" pTemplate="body" let-editing="editing" let-data>
                        <tr [pEditableRow]="data">
                            <td class="text-center">{{ i + 1 }}</td>
                            <td class="text-center">
                                {{ data?.classification }}
                            </td>
                            <td>{{ data?.description }}</td>
                            <td class="text-center">{{ data?.type_mesure }}</td>
                            <td class="text-center">{{ data?.unite }}</td>
                            <td class="text-center" style="width: 4rem !important">
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <input class="text-center" pInputText type="number" [(ngModel)]="data.seuil"
                                            #data.seuil="ngModel" />
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        <span>{{ data.seuil }}</span>
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td style="width: 4rem">
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-inputSwitch trueValue="actif" falseValue="inactif" [(ngModel)]="data.statut"
                                            #data.statut="ngModel"></p-inputSwitch>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        <span [ngStyle]="{ 'font-size': '16px' }" class="badge" [class.badge-success]="
                                                data.statut === 'actif'
                                            " [class.badge-danger]="
                                                data.statut !== 'actif'
                                            ">
                                            {{ data.statut }}
                                        </span>
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td class="text-center" *ngIf="!currentObject.show">
                                <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow
                                    pTooltip="Modifier" tooltipPosition="top" icon="pi pi-pencil"
                                    (click)="OnEditOneRowMetrique(data)" class="p-button-secondary"></button>
                                <button *ngIf="editing" [disabled]="currentObject.show" pButton pRipple type="button"
                                    pSaveEditableRow pTooltip="Sauvegarder" tooltipPosition="top" icon="pi pi-check"
                                    (click)="onRowEditMetriqueSave(data)" class="p-button-success"></button>
                                <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow
                                    pTooltip="Fermer" tooltipPosition="top" icon="pi pi-times"
                                    (click)="onCancelRowSmsMetrique(data, i)" class="p-button-danger"
                                    style="margin-left: 1rem"></button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </p-tabPanel> -->
        <p-tabPanel header="HISTORIQUE">
            <ng-container *ngIf="detailsCurrentTabPanelIndex === 1">
                <app-history
                    [typeModel]="'profil_supervisions'"
                    [idModel]="currentObject?.id"
                ></app-history>
            </ng-container>
        </p-tabPanel>
    </p-tabView>
</div>
