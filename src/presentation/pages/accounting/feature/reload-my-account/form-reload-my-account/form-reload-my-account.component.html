<div class="container-fluid">
    <div class="row">
        <div class="col-sm-12">
            <app-breadcrumb [title]="module | translate" [active_item]="subModule | translate"></app-breadcrumb>
            <div class="card">
                <div class="card-body">
                    <div *ngIf="!displayUrlErrorPage">
                        <div>
                            <div class="forms-feature-header">
                                <div>
                                    <h4>
                                        <b>
                                            <span>
                                                <ng-container *ngIf="isCreateMode">
                                                    {{
                                                    'ACCOUNT_RELOAD_FORM'
                                                    | translate
                                                    }}
                                                </ng-container>
                                                <ng-container *ngIf="isEditMode">
                                                    {{
                                                    'EDIT_ACCOUNT_CREDIT_TRANSACTION'
                                                    | translate
                                                    }}
                                                </ng-container>
                                                <ng-container *ngIf="isDetailsMode">
                                                    {{
                                                    'DETAILS_ACCOUNT_CREDIT_TRANSACTION'
                                                    | translate
                                                    }}
                                                </ng-container>
                                            </span>
                                            <span *ngIf="urlParamTransaction" class="current_values">[{{
                                                urlParamTransaction
                                                }}]</span>
                                        </b>
                                    </h4>
                                </div>
                                <div class="d-flex gap-3">
                                    <div *ngIf="isEditMode && 
                                    (transactionDetails$ | async).statut === MY_RELOADS_STATUS_ENUM.WAITING">
                                        <button pButton pRipple class="p-button-warning w-100"
                                            [label]="'ABANDON' | translate"
                                            (click)="onLetDownReloadMyAccount()"></button>
                                    </div>
                                    <div *ngIf="isEditMode && 
                                        ((transactionDetails$ | async).statut === MY_RELOADS_STATUS_ENUM.WAITING ||
                                        (transactionDetails$ | async).statut === MY_RELOADS_STATUS_ENUM.REJECTED)">
                                        <p-button [label]="'SAVE' | translate" styleClass="p-button-success"
                                            [class.p-disabled]="formFundMyAccount.invalid" 
                                            (click)="handleUpdateReloadMyAccount()">
                                        </p-button>
                                    </div>
                                    <div *ngIf="isCreateMode">
                                        <p-button [label]="'SAVE' | translate" styleClass="p-button-success"
                                            [class.p-disabled]="
                                                formFundMyAccount.invalid
                                            " (click)="handleFundReloadMyAccount()">
                                        </p-button>
                                    </div>
                                    <div>
                                        <p-button [label]="'CLOSE' | translate" (click)="closeInterface()"
                                            styleClass="p-button-danger">
                                        </p-button>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 3rem">
                                <div [formGroup]="formFundMyAccount">
                                    <fieldset>
                                        <legend>
                                            <b>{{
                                                'ACCOUNT_RESERVED' | translate
                                                }}</b>
                                        </legend>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label><b>{{
                                                            'BANK'
                                                            | translate
                                                            }}<span class="text-danger">*</span></b></label>
                                                    <p-dropdown formControlName="code_banque_beneficiaire" [options]="
                                                            listBanksBenefit$
                                                                | async
                                                        " [filter]="true" filterBy="nom" [showClear]="true"
                                                        optionLabel="nom" optionValue="code" placeholder="{{
                                                            'SELECT' | translate
                                                        }} {{
                                                            'BANK_BENEFIT'
                                                                | translate
                                                        }}" emptyFilterMessage="{{
                                                            'NO_MATCH'
                                                                | translate
                                                        }}" emptyMessage="{{
                                                            'NO_DATA_FOUND'
                                                                | translate
                                                        }}">
                                                    </p-dropdown>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label><b>{{
                                                            'AGENCY_BENEFIT'
                                                            | translate
                                                            }}<span class="text-danger">*</span></b></label>
                                                    <p-dropdown formControlName="code_agence_beneficiaire" [options]="
                                                            listAgencyBenefit$
                                                                | async
                                                        " [filter]="true" filterBy="nom" [showClear]="true"
                                                        optionLabel="nom" optionValue="code" placeholder="{{
                                                            'SELECT' | translate
                                                        }} {{
                                                            'AGENCY_BENEFIT'
                                                                | translate
                                                        }}" emptyFilterMessage="{{
                                                            'NO_MATCH'
                                                                | translate
                                                        }}" emptyMessage="{{
                                                            'NO_DATA_FOUND'
                                                                | translate
                                                        }}">
                                                    </p-dropdown>
                                                </div>
                                            </div>
                                            <div class="col-md-3 bankBenefitNumber">
                                                <label><b>{{
                                                        'NUMBER_ACCOUNT'
                                                        | translate
                                                        }}</b></label>
                                                <input formControlName="reference" type="text" pInputText [style]="{
                                                        minWidth: '100%'
                                                    }" />
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label><b>{{
                                                            'AMOUNT'
                                                            | translate
                                                            }}
                                                            (Fcfa)<span class="text-danger">*</span></b></label>
                                                    <input formControlName="montant" type="number" pInputText
                                                        placeholder="{{
                                                            'AMOUNT' | translate
                                                        }}" [style]="{
                                                            minWidth: '100%'
                                                        }" />
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <legend>
                                            <b>{{
                                                'MODE_OF_CREDIT' | translate
                                                }}</b>
                                        </legend>
                                        <div class="row" style="
                                                padding-right: 0;
                                                padding-left: 3px;
                                                display: flex;
                                                gap: 4px;
                                                flex-wrap: nowrap;
                                            ">
                                            <div class="col-md-3 d-flex justify-content-around gap-2" style="
                                                    border: 1px solid #ced4da;
                                                    height: 3.6rem;
                                                    border-radius: 6px;
                                                ">
                                                <div
                                                    class="d-flex align-items-center justify-content-around gap-2 form-check form-check-inline p-0 m-0">
                                                    <input class="form-check-input" type="radio" name="transaction_mode"
                                                        value="Espèce" id="species" formControlName="mode_paiement"
                                                        #species style="
                                                            width: 25px;
                                                            height: 25px;
                                                        " />
                                                    <label class="form-check-label fs-5" for="species"
                                                        style="width: inherit">
                                                        <strong>{{
                                                            'SPECIE' | translate
                                                            }}</strong>
                                                    </label>
                                                </div>
                                                <div
                                                    class="d-flex align-items-center justify-content-around gap-2 form-check form-check-inline p-0 m-0">
                                                    <input class="form-check-input" type="radio" name="transaction_mode"
                                                        value="Chèque" id="cheque" formControlName="mode_paiement"
                                                        #cheque style="
                                                            width: 25px;
                                                            height: 25px;
                                                        " />
                                                    <label class="form-check-label fs-5" for="cheque">
                                                        <strong>{{
                                                            'CHEQUE' | translate
                                                            }}</strong>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-md-9" style="padding-right: 10px" *ngIf="species.checked">
                                                <input type="text" pInputText disabled [value]="
                                                        'THE_AMOUNT_OF_THE_DEPOSIT_WILL_BE_CARRIED_OVER_TO_YOUR_BALANCE'
                                                            | translate
                                                    " />
                                            </div>
                                            <div class="col-md-9" *ngIf="cheque.checked" style="
                                                    padding-right: 10px;
                                                    display: flex;
                                                    flex-wrap: nowrap;
                                                    gap: 4px;
                                                ">
                                                <input type="text" pInputText disabled [value]="
                                                        'THE_AMOUNT_OF_THE_CHEQUE_WILL_BE_CARRIED_OVER_TO_YOUR_BALANCE'
                                                            | translate
                                                    " />
                                            </div>
                                        </div>
                                        

                                        <div class="d-flex justify-content-between align-items-center">
                                            <h2 class="text-start text-orange pt-4">
                                                <b>Bordereau de
                                                    {{
                                                    this.formFundMyAccount.get(
                                                    'mode_paiement'
                                                    ).value === 'Espèce'
                                                    ? 'Versement Espèce'
                                                    : 'Remise ' +
                                                    this.formFundMyAccount.get(
                                                    'mode_paiement'
                                                    ).value
                                                    }}</b>
                                            </h2>
                                            <p-button [label]="'LAST_SLIP_ATTACHMENT' | translate" styleClass="p-button-success"
                                                *ngIf="isEditMode" pTooltip="Clique pour voir la taille normal" tooltipPosition="top"
                                            (click)="showFilePreview()">
                                            </p-button>
                                        </div>

                                        <ng-container *ngIf="
                                                species.checked;
                                                else chequeForm
                                            ">
                                            <div class="row">
                                                <div class="col-md-2">
                                                    <label>
                                                        <b>{{
                                                            'NAME_OF_APPLICANT'
                                                            | translate
                                                            }}<span class="text-danger">*</span></b>
                                                    </label>
                                                    <input formControlName="nom_deposant" type="text" pInputText
                                                        placeholder="{{
                                                            'NAME_OF_APPLICANT'
                                                                | translate
                                                        }}" [style]="{
                                                            minWidth: '100%'
                                                        }" />
                                                </div>
                                                <div class="col-md">
                                                    <label>
                                                        <b>{{
                                                            'PRENAME_OF_APPLICANT'
                                                            | translate
                                                            }}<span class="text-danger">*</span></b></label>
                                                    <input formControlName="prenom_deposant" type="text" pInputText
                                                        placeholder="{{
                                                            'PRENAME_OF_APPLICANT'
                                                                | translate
                                                        }}" [style]="{
                                                            minWidth: '100%'
                                                        }" />
                                                </div>
                                                <div class="col-md-2">
                                                    <label>
                                                        <b>{{
                                                            'NUMBER_PHONE_APPLICANT'
                                                            | translate
                                                            }}<span class="text-danger">*</span></b>
                                                    </label>
                                                    <input formControlName="contact_deposant" type="text" pInputText
                                                        placeholder="{{
                                                            'NUMBER_PHONE_APPLICANT'
                                                                | translate
                                                        }}" [style]="{
                                                            minWidth: '100%'
                                                        }" />
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label><b>{{
                                                                'DATE'
                                                                | translate
                                                                }}<span class="text-danger">*</span></b></label>
                                                        <p-calendar formControlName="date_remise" [showIcon]="true"
                                                            [placeholder]="'AAAA-MM-JJ'" dateFormat="yy-mm-dd" [style]="{
                                                                minWidth: '100%'
                                                            }">
                                                        </p-calendar>
                                                    </div>
                                                </div>
                                                <div class="col-md">
                                                    <div class="form-group">
                                                        <label>
                                                            <b>{{
                                                                'SLIP_ATTACHMENT'
                                                                | translate
                                                                }}<span class="text-danger">*</span></b>
                                                        </label>
                                                        <ng-container *ngIf="
                                                                !isDetailsMode;
                                                                else fileReadonlyBlock
                                                            ">
                                                            <input type="file" (change)="
                                                                    onChangeFile(
                                                                        $event
                                                                            .target
                                                                            .files
                                                                    )
                                                                " accept="image/png,image/jpeg" style="
                                                                    padding: 0.7rem;
                                                                    border: 1px
                                                                        solid
                                                                        #000;
                                                                    border-radius: 0.3rem;
                                                                " />
                                                        </ng-container>
                                                        <!-- <input type="file" (change)="
                                                                onChangeFile(
                                                                    $event
                                                                        .target
                                                                        .files
                                                                )
                                                            " accept="image/png,image/jpeg" style="
                                                                padding: 0.7rem;
                                                                border: 1px
                                                                    solid#000;
                                                                border-radius: 0.3rem;
                                                                color: #000;
                                                            " /> -->
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <ng-template #chequeForm>
                                            <div class="row">
                                                <div class="col-md-2">
                                                    <label><b>{{
                                                            'NUMBER_CHEQUE'
                                                            | translate
                                                            }}<span class="text-danger">*</span></b></label>
                                                    <input formControlName="numero_cheque" type="text" pInputText
                                                        placeholder="{{
                                                            'SHOOTER'
                                                                | translate
                                                        }}" [style]="{
                                                            minWidth: '100%'
                                                        }" />
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>
                                                            <b>{{
                                                                'BANK'
                                                                | translate
                                                                }}<span class="text-danger">*</span></b>
                                                        </label>
                                                        <p-dropdown formControlName="code_banque_tireur" [options]="
                                                                listBanks$
                                                                    | async
                                                            " optionLabel="nom" optionValue="code" [filter]="true"
                                                            filterBy="nom" placeholder="{{
                                                                'SELECT'
                                                                    | translate
                                                            }} {{
                                                                'BANK'
                                                                    | translate
                                                            }}" emptyFilterMessage="{{
                                                                'NO_MATCH'
                                                                    | translate
                                                            }}" [showClear]="true" emptyMessage="{{
                                                                'NO_DATA_FOUND'
                                                                    | translate
                                                            }}">
                                                        </p-dropdown>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <label><b>{{
                                                            'SHOOTER'
                                                            | translate
                                                            }}<span class="text-danger">*</span></b></label>
                                                    <input formControlName="nom_tireur" type="text" pInputText
                                                        placeholder="{{
                                                            'SHOOTER'
                                                                | translate
                                                        }}" [style]="{
                                                            minWidth: '100%'
                                                        }" />
                                                </div>
                                                <div class="col-md-2">
                                                    <label><b>{{
                                                            'NUMBER_PHONE_APPLICANT'
                                                            | translate
                                                            }}<span class="text-danger">*</span></b></label>
                                                    <input formControlName="contact_deposant" type="text" pInputText
                                                        placeholder="{{
                                                            'NUMBER_PHONE_APPLICANT'
                                                                | translate
                                                        }}" [style]="{
                                                            minWidth: '100%'
                                                        }" />
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label><b>{{
                                                                'DATE'
                                                                | translate
                                                                }}<span class="text-danger">*</span></b></label>
                                                        <p-calendar formControlName="date_remise" [showIcon]="true"
                                                            [placeholder]="'AAAA-MM-JJ'" dateFormat="yy-mm-dd" [style]="{
                                                                minWidth: '100%'
                                                            }">
                                                        </p-calendar>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>
                                                            <b>{{
                                                                'SLIP_ATTACHMENT'
                                                                | translate
                                                                }}<span class="text-danger">*</span></b>
                                                        </label>
                                                        <ng-container *ngIf="
                                                                !isDetailsMode;
                                                                else fileReadonlyBlock
                                                            ">
                                                            <input type="file" (change)="
                                                                    onChangeFile(
                                                                        $event
                                                                            .target
                                                                            .files
                                                                    )
                                                                " accept="image/png,image/jpeg" style="
                                                                    padding: 0.7rem;
                                                                    border: 1px
                                                                        solid
                                                                        #000;
                                                                    border-radius: 0.3rem;
                                                                " />
                                                        </ng-container>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-template>

                                        <ng-template #fileReadonlyBlock>
                                            <div class="mt-2">
                                                <img *ngIf="filePreviewUrl" [src]="filePreviewUrl" alt="attachment"
                                                    style="max-width: 100%; max-height: 200px;" 
                                                    pTooltip="Clique pour voir la taille normal" tooltipPosition="top"
                                                    (click)="showFilePreview()"/>
                                                <p *ngIf="!filePreviewUrl" class="text-muted">
                                                    {{'SLIP_ATTACHMENT' | translate}}
                                                </p>
                                            </div>
                                        </ng-template>

                                    </fieldset>
                                </div>
                                <div class="forms-feature-footer">
                                    <div *ngIf="isEditMode && 
                                    (transactionDetails$ | async).statut === MY_RELOADS_STATUS_ENUM.WAITING">
                                        <button pButton pRipple class="p-button-warning w-100"
                                            [label]="'ABANDON' | translate"
                                            (click)="onLetDownReloadMyAccount()"></button>
                                    </div>
                                    <div *ngIf="isEditMode && 
                                        ((transactionDetails$ | async).statut === MY_RELOADS_STATUS_ENUM.WAITING ||
                                        (transactionDetails$ | async).statut === MY_RELOADS_STATUS_ENUM.REJECTED)">
                                        <p-button [label]="'SAVE' | translate" styleClass="p-button-success"
                                            [class.p-disabled]="formFundMyAccount.invalid" 
                                            (click)="handleUpdateReloadMyAccount()">
                                        </p-button>
                                    </div>
                                    <div *ngIf="isCreateMode">
                                        <p-button [label]="'SAVE' | translate" styleClass="p-button-success"
                                            [class.p-disabled]="
                                                formFundMyAccount.invalid
                                            " (click)="handleFundReloadMyAccount()">
                                        </p-button>
                                    </div>
                                </div>
                            </div>
                        </div>
            

                        <p-dialog [header]="'LAST_SLIP_ATTACHMENT' | translate" [modal]="true" [(visible)]="visibleFilePreview"
                            [style]="{ width: 'fit-content', height: 'fit-content', textAlign: 'center' }">
                            <img *ngIf="filePreviewUrl" [src]="filePreviewUrl" alt="attachment" 
                                style="width: 'fit-content'; height: 'fit-content'" />
                            <p *ngIf="!filePreviewUrl" class="text-muted">
                                {{'SLIP_ATTACHMENT' | translate}}
                            </p>
                        </p-dialog>
                    </div>

                    <div *ngIf="displayUrlErrorPage">
                        <div>
                            <div class="d-flex justify-content-end">
                                <p-button [label]="'CLOSE' | translate" styleClass="p-button-danger"
                                    (click)="onGoToBack()">
                                </p-button>
                            </div>
                        </div>
                        <div class="d-flex justify-content-center align-items-center text-danger">
                            {{ 'NO_DATA_FOUND' | translate }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>