<div class="container-fluid">
    <div>
        <div class="container_flex_space_between mb-3">
            <div>
                <h3>
                    <b>
                        <span>Affectation au Profil</span>
                        <span class="current_values"
                            >[{{ currentObject?.nom }}]</span
                        >
                    </b>
                </h3>
            </div>
            <div class="table_actions_wrapper mt-0">
                <button
                    pButton
                    pRipple
                    label="Fermer"
                    class="p-button-danger"
                    (click)="close()"
                ></button>
            </div>
        </div>
        <div class="table_content_wrapper">
            <p-table
                #dt
                [value]="listAffectations"
                [rows]="10"
                [paginator]="true"
                responsiveLayout="scroll"
                [rowHover]="true"
                dataKey="id"
                currentPageReportTemplate="Affichage de {first} à {last} des {totalRecords} données"
                [globalFilterFields]="[
                    'nom',
                    'prenoms',
                    'code',
                    'username',
                    'contacts'
                ]"
                [showCurrentPageReport]="true"
                responsiveLayout="scroll"
                scrollable="true"
                scrollHeight="flex"
                width="100%"
                class="responsive-claims-table"
            >
                <ng-template pTemplate="caption">
                    <div class="table_header">
                        <div class="table_header__legende">
                            <h4>
                                <b>Liste des utilisateurs à affecter</b>
                            </h4>
                        </div>
                        <div style="display: flex; gap: 1rem">
                            <div>
                                <button
                                    pButton
                                    pRipple
                                    label="Affecter"
                                    icon="pi pi-arrow-right"
                                    class="p-button-success"
                                    (click)="handleSaveAffectation()"
                                    [disabled]="checkconsumerList?.length === 0"
                                ></button>
                            </div>
                            <div>
                                <span class="p-input-icon-left ml-auto">
                                    <i class="pi pi-search"></i>
                                    <input
                                        pInputText
                                        type="text"
                                        (input)="
                                            dt.filterGlobal(
                                                $event.target.value,
                                                'contains'
                                            )
                                        "
                                        placeholder="Recherche"
                                    />
                                </span>
                            </div>
                        </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th class="text-center">#</th>
                        <th>Nom</th>
                        <th>Prénom</th>
                        <th>Contact</th>
                        <th>Nom de connexion</th>
                        <th class="text-center">
                            <p-checkbox
                                [binary]="true"
                                (click)="OnCheckAllConsumer()"
                                [(ngModel)]="checkedAllConsumers"
                            ></p-checkbox>
                        </th>
                    </tr>
                </ng-template>
                <ng-template let-i="rowIndex" pTemplate="body" let-data>
                    <tr>
                        <td class="text-center">{{ i + 1 }}</td>
                        <td>{{ data.nom }}</td>
                        <td>{{ data.prenoms }}</td>
                        <td>{{ data.contact }}</td>
                        <td>{{ data.username }}</td>
                        <td class="text-center">
                            <p-checkbox
                                name="groupname"
                                [value]="data.id"
                                [binary]="true"
                                [(ngModel)]="data.checked"
                                (click)="onCheckedOneConsumer(data)"
                            ></p-checkbox>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>
