<div>
    <div
        class="container_flex_space_between mb-3"
        style="margin-top: -1rem !important"
    >
        <span class="table-header-wrapper">
            <b
                >Réaffectation du Profil
                <span class="current_values">[{{ currentObject?.nom }}]</span>
            </b>
        </span>
        <div class="table_actions_wrapper mt-0">
            <div class="table_actions_wrapper mt-0">
                <button
                    pButton
                    pRipple
                    label="Fermer"
                    class="p-button-danger"
                    (click)="close()"
                ></button>
            </div>
        </div>
    </div>
    <div class="table_content_wrapper">
        <p-table
            #dt
            [value]="listAffectations"
            [rows]="10"
            [paginator]="true"
            responsiveLayout="scroll"
            [rowHover]="true"
            dataKey="id"
            currentPageReportTemplate="Affichage de {first} à {last} des {totalRecords} données"
            [globalFilterFields]="[
                'nom',
                'prenoms',
                'code',
                'username',
                'contacts'
            ]"
            [showCurrentPageReport]="true"
            responsiveLayout="scroll"
            scrollable="true"
            scrollHeight="flex"
            width="100%"
            class="responsive-claims-table"
        >
            <ng-template pTemplate="caption">
                <div class="table_header">
                    <div class="table_header__legende">
                        <h4>
                            <b>Liste des utilisateurs à réaffectation</b>
                        </h4>
                    </div>
                    <div style="display: flex; gap: 1rem">
                        <div>
                            <button
                                pButton
                                pRipple
                                *ngIf="mappingService.IsAction()"
                                label="Retirer"
                                icon="pi pi-times"
                                class="p-button-danger"
                                (click)="handleRetraitSim()"
                                [disabled]="checkconsumerList?.length === 0"
                            ></button>
                            <button
                                pButton
                                pRipple
                                label="Réaffecter"
                                *ngIf="mappingService.IsAction()"
                                icon="pi pi-arrows-h"
                                class="p-button-success ms-2"
                                (click)="openForm(content)"
                                [disabled]="checkconsumerList?.length === 0"
                            ></button>
                        </div>
                        <div>
                            <span class="p-input-icon-left ml-auto">
                                <i class="pi pi-search"></i>
                                <input
                                    pInputText
                                    type="text"
                                    (input)="
                                        dt.filterGlobal(
                                            $event.target.value,
                                            'contains'
                                        )
                                    "
                                    placeholder="Recherche"
                                />
                            </span>
                        </div>
                    </div>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th class="text-center">#</th>
                    <th>Nom</th>
                    <th>Prénom</th>
                    <th>Contact</th>
                    <th>Nom de Connexion</th>
                    <th class="text-center" *ngIf="mappingService.IsAction()">
                        <p-checkbox
                            [binary]="true"
                            (click)="OnCheckAllConsumer()"
                            [(ngModel)]="checkedAllConsumers"
                        ></p-checkbox>
                    </th>
                </tr>
            </ng-template>
            <ng-template let-i="rowIndex" pTemplate="body" let-data>
                <tr>
                    <td class="text-center">{{ i + 1 }}</td>
                    <td>{{ data.nom }}</td>
                    <td>{{ data.prenoms }}</td>
                    <td>{{ data.contacts }}</td>
                    <td>{{ data.username }}</td>
                    <td class="text-center" *ngIf="mappingService.IsAction()">
                        <p-checkbox
                            name="groupname"
                            [value]="data.id"
                            [binary]="true"
                            [(ngModel)]="data.checked"
                            (click)="onCheckedOneConsumer(data)"
                        ></p-checkbox>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
<ng-template #content let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">
            Réafectation Utilisateur
        </h4>
        <button
            type="button"
            class="btn-close"
            aria-label="Close"
            (click)="hideForm()"
        ></button>
    </div>
    <div class="modal-body" novalidate>
        <div class="form-group">
            <label
                ><b>Profils<span class="text-danger">*</span></b></label
            >
            <p-dropdown
                [options]="listDatas"
                [(ngModel)]="selectedProfil"
                optionLabel="nom"
                [showClear]="true"
                placeholder="Selectionner le profil"
            >
                <ng-template let-data pTemplate="item">
                    <div class="country-item">
                        <div>{{ data.nom }}</div>
                    </div>
                </ng-template>
            </p-dropdown>
        </div>
    </div>
    <div class="modal-footer">
        <div>
            <button type="button" class="btn btn-hide" (click)="hideForm()">
                Fermer
            </button>
        </div>
        <div>
            <button
                type="button"
                class="btn btn-save"
                (click)="handleSaveReaffectation()"
                [disabled]="!selectedProfil"
            >
                Valider
            </button>
        </div>
    </div>
</ng-template>
