<!-- report.component.html -->
<main class="reporting-container" role="main">
    <section class="reporting-header-section">
        <article class="reporting-content">
            <app-breadcrumb
                class="reporting-breadcrumb"
                [title]="module() | translate"
                [active_item]="subModule() | translate"
            >
            </app-breadcrumb>

            <section
                class="reporting-card"
                [class.fullscreen-mode]="dashboardState.isFullscreen()"
            >
                <header class="reporting-card-header">
                    <div class="header-content">
                        <div class="title-section">
                            <app-page-title
                                class="page-title-component"
                                [displayDate]="false"
                                [displayList]="false"
                                [title]="'REPORTING.LABEL' | translate"
                            >
                            </app-page-title>
                        </div>

                        <div class="header-actions">
                            <button
                                pButton
                                [icon]="
                                    dashboardState.isFullscreen()
                                        ? 'pi pi-compress'
                                        : 'pi pi-expand'
                                "
                                class="p-button-outlined p-button-secondary action-btn"
                                (click)="toggleFullscreen()"
                                pTooltip="{{
                                    dashboardState.isFullscreen()
                                        ? 'REPORTING.DASHBOARD.ACTIONS.EXIT_FULLSCREEN'
                                        : ('REPORTING.DASHBOARD.ACTIONS.ENTER_FULLSCREEN'
                                          | translate)
                                }}"
                                tooltipPosition="bottom"
                            ></button>

                            @if (dashboardState.isFullscreen()) {
                                <button
                                    class="close-fullscreen-btn"
                                    (click)="toggleFullscreen()"
                                    pTooltip="{{
                                        'REPORTING.DASHBOARD.ACTIONS.EXIT_FULLSCREEN'
                                            | translate
                                    }}"
                                >
                                    <i class="pi pi-times"></i>
                                </button>
                            }
                        </div>
                    </div>
                </header>

                <div class="reporting-card-body">
                    @if (dashboardState.isLoading()) {
                        <div class="loading-state">
                            <p-progressSpinner
                                strokeWidth="4"
                                animationDuration=".5s"
                            >
                            </p-progressSpinner>
                            <h3>
                                {{ 'REPORTING.DASHBOARD.LOADING' | translate }}
                            </h3>
                            <p>
                                {{
                                    'REPORTING.REPORT.LOADING_DESCRIPTION'
                                        | translate
                                }}
                            </p>
                        </div>
                    }

                    @if (
                        dashboardState.hasError() && !dashboardState.isLoading()
                    ) {
                        <div class="error-state">
                            <div class="error-icon">
                                <i class="pi pi-exclamation-triangle"></i>
                            </div>
                            <h3>
                                {{ 'REPORTING.DASHBOARD.ERROR' | translate }}
                            </h3>
                            <p>
                                {{
                                    'REPORTING.REPORT.ERROR_DESCRIPTION'
                                        | translate
                                }}
                            </p>
                            <button
                                pButton
                                icon="pi pi-refresh"
                                label="{{
                                    'REPORTING.DASHBOARD.ACTIONS.RETRY'
                                        | translate
                                }}"
                                (click)="refreshDashboard()"
                                class="p-button-primary"
                            ></button>
                        </div>
                    }

                    @if (
                        !dashboardState.hasError() &&
                        !dashboardState.isLoading()
                    ) {
                        <div
                            class="grafana-container"
                            [class.fullscreen]="dashboardState.isFullscreen()"
                        >
                            <iframe
                                [src]="GRAFANA_URL | safeUrl"
                                (load)="onIframeLoad()"
                                (error)="onIframeError()"
                                frameborder="0"
                                allowfullscreen
                                class="grafana-iframe"
                                title="Dashboard Grafana - Tableau de bord analytique"
                            >
                            </iframe>
                        </div>
                    }
                </div>
            </section>
        </article>
    </section>
</main>
