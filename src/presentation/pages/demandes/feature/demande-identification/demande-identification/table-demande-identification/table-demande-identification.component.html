<p-table
    #dt
    [value]="listDemandesIntegrations"
    [rowHover]="true"
    dataKey="id"
    selectionMode="single"
    [(selection)]="selectedDemandeIntegration"
    [ngClass]="['native_table table']"
    [rows]="50"
    [globalFilterFields]="[
        'created_at',
        'numero_demande',
        'nb_demande_soumises',
        'nb_demande_traitees',
        'statut',
        'traitement',
        'demandeur_nom',
        'demandeur_prenoms'
    ]"
>
    <ng-template pTemplate="caption">
        <div class="d-flex justify-content-between">
            <app-table-header
                [count]="listDemandesIntegrations"
                [legende]="'Demandes Identifications'"
                [page]="pargination?.currentPage"
                [totalPage]="pargination?.last_page"
            >
            </app-table-header>
            <div>
                <span class="p-input-icon-left">
                    <i class="pi pi-search"></i>
                    <input
                        pInputText
                        type="text"
                        (input)="
                            dt.filterGlobal($event.target.value, 'contains')
                        "
                        placeholder="Recherche..."
                    />
                </span>
            </div>
        </div>
    </ng-template>
    <ng-template pTemplate="header">
        <tr>
            <th class="text-center">#</th>
            <th class="text-center">Date Demande</th>
            <th class="text-center">N° Dossier</th>
            <th class="text-center"># Lignes</th>
            <th class="text-center"># Traitées</th>
            <th class="text-center">Etape</th>
            <th class="text-center">Etat</th>
            <th class="text-center">Demandeur</th>
            <th class="text-center">Actions</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-rowIndex="rowIndex" let-demande>
        <tr [pSelectableRow]="demande">
            <td class="text-center">
                {{ rowIndex + pargination?.offset }}
            </td>
            <td class="text-center">
                {{ demande?.created_at }}
            </td>
            <td
                class="cursor-pointer text-center"
                (click)="copyData(demande, 'numero_demande')"
            >
                {{ demande?.numero_demande }}
            </td>
            <td class="text-center">
                {{ demande?.nb_demande_soumises ?? 'N/A' }}
            </td>
            <td class="text-center">
                {{ demande?.nb_demande_traitees ?? 'N/A' }}
            </td>
            <td class="text-center">
                <span [class]="'badge_size badge ' + getEtapeBadge(demande)">
                    {{ demande?.statut }}
                </span>
            </td>
            <td class="text-center">
                <span [class]="'badge ' + getEtatBadge(demande)">
                    {{
                        demande.traitement === BADGE_ETAT.COMPLET
                            ? 'complet'
                            : demande.traitement
                    }}
                </span>
            </td>
            <td class="text-center">
                {{ demande?.demandeur_nom }} {{ demande?.demandeur_prenoms }}
            </td>
            <td class="text-center d-flex gap-2 justify-content-center">
                <button
                    pButton
                    icon="pi pi-folder-open"
                    pTooltip="Voir"
                    tooltipPosition="top"
                    (click)="onAction(demande, 'dossier', 'page')"
                    class="p-button-dark"
                ></button>
                <button
                    pButton
                    icon="pi pi-pencil"
                    tooltipPosition="top"
                    class="p-button-secondary"
                    (click)="onAction(demande, 'editer', 'page')"
                    [pTooltip]="
                        isDisableEditButton()
                            ? 'Editer'
                            : 'Impossible d\'editer'
                    "
                    [disabled]="isDisableEditButton() ? false : true"
                ></button>
                <button
                    pButton
                    tooltipPosition="top"
                    (click)="onAction(demande, 'traitement', 'modal')"
                    [ngClass]="getStyleButtonTraitement(demande).class"
                    [icon]="getStyleButtonTraitement(demande).icon"
                    [pTooltip]="getStyleButtonTraitement(demande).tooltip"
                ></button>
                <button
                    pButton
                    icon="pi pi-book"
                    pTooltip="Journal"
                    tooltipPosition="top"
                    (click)="showJournal(demande)"
                    class="p-button-primary"
                ></button>
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
        <tr *ngIf="listDemandesIntegrations?.length <= 0 && !spinner">
            <td colspan="9">
                <span class="empty-message"> Aucune donnée disponible </span>
            </td>
        </tr>
        <tr *ngIf="spinner">
            <td colspan="9">
                <p-progressSpinner
                    class="spinner"
                    [style]="{ width: '40px', height: '50px' }"
                    styleClass="custom-spinner"
                    strokeWidth="8"
                    fill="#EEEEEE"
                    animationDuration=".5s"
                >
                </p-progressSpinner>
            </td>
        </tr>
    </ng-template>
    <style>
        .table-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .p-table {
            width: 100%;
        }

        .numero_tableau_width {
            width: 60px;
        }

        .date_width {
            width: 150px;
        }

        .numero_demande_width {
            width: 120px;
        }

        .lignes_traitees_width {
            width: 100px;
        }

        .badge_width {
            width: 120px;
        }

        .badge {
            padding: 0.44em 0.7em !important;
            font-weight: 500;
            font-size: 16px;
        }

        .demandeur_width {
            width: 200px;
        }

        .actions_width {
            width: 200px;
        }

        .empty-message {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem;
            color: #888;
        }

        .spinner {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .p-table {
            width: 100%;
            text-align: center !important;
        }

        th,
        td {
            text-align: center !important;
            vertical-align: middle !important;
        }

        .cursor-pointer {
            cursor: pointer;
        }

        .badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }

        .badge_active {
            background-color: #28a745;
            color: white;
        }

        .badge_inactive {
            background-color: #dc3545;
            color: white;
        }
    </style>
</p-table>
